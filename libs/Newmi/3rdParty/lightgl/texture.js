function Texture(e,r,t){t=t||{},this.id=gl.createTexture(),this.width=e,this.height=r,this.format=t.format||gl.RGBA,this.type=t.type||gl.UNSIGNED_BYTE,gl.bindTexture(gl.TEXTURE_2D,this.id),t.noFlip||gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,1),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,t.filter||t.magFilter||gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,t.filter||t.minFilter||gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,t.wrap||t.wrapS||gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,t.wrap||t.wrapT||gl.CLAMP_TO_EDGE),gl.texImage2D(gl.TEXTURE_2D,0,this.format,e,r,0,this.format,this.type,null)}var framebuffer,renderbuffer,checkerboardCanvas;Texture.prototype={bind:function(e){gl.activeTexture(gl.TEXTURE0+(e||0)),gl.bindTexture(gl.TEXTURE_2D,this.id)},unbind:function(e){gl.activeTexture(gl.TEXTURE0+(e||0)),gl.bindTexture(gl.TEXTURE_2D,null)},drawTo:function(e){var r=gl.getParameter(gl.VIEWPORT);framebuffer=framebuffer||gl.createFramebuffer(),renderbuffer=renderbuffer||gl.createRenderbuffer(),gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer),gl.bindRenderbuffer(gl.RENDERBUFFER,renderbuffer),(this.width!=renderbuffer.width||this.height!=renderbuffer.height)&&(renderbuffer.width=this.width,renderbuffer.height=this.height,gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,this.width,this.height)),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.id,0),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,renderbuffer),gl.viewport(0,0,this.width,this.height),e(),gl.bindFramebuffer(gl.FRAMEBUFFER,null),gl.bindRenderbuffer(gl.RENDERBUFFER,null),gl.viewport(r[0],r[1],r[2],r[3])},swapWith:function(e){var r;r=e.id,e.id=this.id,this.id=r,r=e.width,e.width=this.width,this.width=r,r=e.height,e.height=this.height,this.height=r}},Texture.fromImage=function(e,r){r=r||{};var t=new Texture(e.width,e.height,r);try{gl.texImage2D(gl.TEXTURE_2D,0,t.format,t.format,t.type,e)}catch(i){throw"file:"==location.protocol?'image not loaded for security reasons (serve this page over "http://" instead)':"image not loaded for security reasons (image must originate from the same domain as this page or use Cross-Origin Resource Sharing)"}return r.minFilter&&r.minFilter!=gl.NEAREST&&r.minFilter!=gl.LINEAR&&gl.generateMipmap(gl.TEXTURE_2D),t},Texture.fromURL=function(e,r){checkerboardCanvas=checkerboardCanvas||function(){var e=document.createElement("canvas").getContext("2d");e.canvas.width=e.canvas.height=128;for(var r=0;r<e.canvas.height;r+=16)for(var t=0;t<e.canvas.width;t+=16)e.fillStyle=16&(t^r)?"#FFF":"#DDD",e.fillRect(t,r,16,16);return e.canvas}();var t=Texture.fromImage(checkerboardCanvas,r),i=new Image,a=gl;return i.onload=function(){a.makeCurrent(),Texture.fromImage(i,r).swapWith(t)},i.src=e,t};